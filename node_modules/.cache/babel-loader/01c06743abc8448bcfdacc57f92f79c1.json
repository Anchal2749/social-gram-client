{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useDispatch,useSelector}from'react-redux';import{useHistory,useParams}from'react-router-dom';import{GLOBALTYPES}from'../../redux/actions/globalTypes';import{addUser,getConversations}from\"../../redux/actions/messageAction\";import{getDataAPI}from'../../utils/fetchData';import UserCard from\"../UserCard\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const LeftSide=()=>{const{auth,message}=useSelector(state=>state);const dispatch=useDispatch();const history=useHistory();const{id}=useParams();const pageEnd=useRef();const[page,setPage]=useState(0);const[search,setSearch]=useState('');const[searchUsers,setSearchUsers]=useState([]);const handleSearch=async e=>{e.preventDefault();if(!search)return setSearchUsers([]);try{const res=await getDataAPI(`search?username=${search}`,auth.token);setSearchUsers(res.data.users);}catch(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err.response.data.msg}});}};const handleAddUser=user=>{setSearch('');setSearchUsers([]);dispatch(addUser({user,message}));return history.push(`/message/${user._id}`);};const isActive=user=>{if(id===user._id)return'active';return'';};useEffect(()=>{if(message.firstLoad)return;dispatch(getConversations({auth}));},[dispatch,auth,message.firstLoad]);useEffect(()=>{const observer=new IntersectionObserver(entries=>{if(entries[0].isIntersecting){setPage(p=>p+1);}},{threshold:0.1});observer.observe(pageEnd.current);},[setPage]);useEffect(()=>{if(message.resultUsers>=(page-1)*9&&page>1){dispatch(getConversations({auth,page}));}},[message.resultUsers,page,auth,dispatch]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{className:\"message_header\",onSubmit:handleSearch,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:search,onChange:e=>setSearch(e.target.value),placeholder:\"search...\"}),/*#__PURE__*/_jsx(\"button\",{style:{display:\"none\"},type:\"submit\",id:\"search\",children:\"Search\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"message_chat_list\",children:[searchUsers.length!==0?/*#__PURE__*/_jsx(_Fragment,{children:searchUsers.map(user=>/*#__PURE__*/_jsx(\"div\",{className:`message_user ${isActive(user)}`,onClick:()=>handleAddUser(user),children:/*#__PURE__*/_jsx(UserCard,{user:user})},user._id))}):/*#__PURE__*/_jsx(_Fragment,{children:message.users.map(user=>/*#__PURE__*/_jsx(\"div\",{cclassName:`message_user ${isActive(user)}`,onClick:()=>handleAddUser(user),children:/*#__PURE__*/_jsx(UserCard,{user:user,msg:true,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-circle\"})})},user._id))}),/*#__PURE__*/_jsx(\"button\",{style:{opacity:0},ref:pageEnd,children:\"Load more..\"})]})]});};export default LeftSide;","map":{"version":3,"names":["React","useState","useEffect","useRef","useDispatch","useSelector","useHistory","useParams","GLOBALTYPES","addUser","getConversations","getDataAPI","UserCard","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LeftSide","auth","message","state","dispatch","history","id","pageEnd","page","setPage","search","setSearch","searchUsers","setSearchUsers","handleSearch","e","preventDefault","res","token","data","users","err","type","ALERT","payload","error","response","msg","handleAddUser","user","push","_id","isActive","firstLoad","observer","IntersectionObserver","entries","isIntersecting","p","threshold","observe","current","resultUsers","children","className","onSubmit","value","onChange","target","placeholder","style","display","length","map","onClick","cclassName","opacity","ref"],"sources":["C:/Users/ANCHAL MAURYA/Desktop/mern-social-media/client/src/components/message/LeftSide.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\nimport { GLOBALTYPES } from '../../redux/actions/globalTypes';\r\nimport { addUser, getConversations } from \"../../redux/actions/messageAction\";\r\nimport { getDataAPI } from '../../utils/fetchData';\r\nimport UserCard from \"../UserCard\";\r\n\r\nconst LeftSide = () => {\r\n    const { auth, message } = useSelector((state) => state);\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const { id } = useParams();\r\n    const pageEnd = useRef();\r\n    const [page, setPage] = useState(0);\r\n\r\n    const [search, setSearch] = useState('');\r\n    const [searchUsers, setSearchUsers] = useState([]);\r\n\r\n    const handleSearch = async e => {\r\n        e.preventDefault();\r\n        if (!search) return setSearchUsers([]);\r\n\r\n    try {\r\n      const res = await getDataAPI(`search?username=${search}`, auth.token);\r\n      setSearchUsers(res.data.users);\r\n    } catch (err) {\r\n      dispatch({\r\n        type: GLOBALTYPES.ALERT,\r\n        payload: { error: err.response.data.msg },\r\n      });\r\n    }\r\n    };\r\n\r\n    const handleAddUser = (user) => {\r\n        setSearch('');\r\n        setSearchUsers([]);\r\n        dispatch(addUser({user, message}));\r\n        return history.push(`/message/${user._id}`);\r\n    };\r\n\r\n    const isActive = (user) => {\r\n      if(id === user._id) return 'active';\r\n      return '';\r\n    }\r\n\r\n    useEffect(() => {\r\n      if (message.firstLoad) return;\r\n      dispatch(getConversations({ auth }));\r\n    }, [dispatch, auth, message.firstLoad]);\r\n\r\n     useEffect(() => {\r\n       const observer = new IntersectionObserver(\r\n         (entries) => {\r\n           if (entries[0].isIntersecting) {\r\n             setPage((p) => p + 1);\r\n           }\r\n         },\r\n         {\r\n           threshold: 0.1,\r\n         }\r\n       );\r\n       observer.observe(pageEnd.current);\r\n     }, [setPage]);\r\n\r\n     useEffect(() => {\r\n       if (message.resultUsers >= (page - 1) * 9 && page > 1) {\r\n         dispatch(getConversations({ auth, page }));\r\n       }\r\n     }, [message.resultUsers, page, auth, dispatch]);\r\n\r\n    return (\r\n      <>\r\n        <form className=\"message_header\" onSubmit={handleSearch}>\r\n          <input\r\n            type=\"text\"\r\n            value={search}\r\n            onChange={(e) => setSearch(e.target.value)}\r\n            placeholder=\"search...\"\r\n          />\r\n\r\n          <button style={{ display: \"none\" }} type=\"submit\" id=\"search\">\r\n            Search\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"message_chat_list\">\r\n          {searchUsers.length !== 0 ? (\r\n            <>\r\n              {searchUsers.map((user) => (\r\n                <div\r\n                  key={user._id}\r\n                  className={`message_user ${isActive(user)}`}\r\n                  onClick={() => handleAddUser(user)}\r\n                >\r\n                  <UserCard user={user} />\r\n                </div>\r\n              ))}\r\n            </>\r\n          ) : (\r\n            <>\r\n              {message.users.map((user) => (\r\n                <div\r\n                  key={user._id}\r\n                  cclassName={`message_user ${isActive(user)}`}\r\n                  onClick={() => handleAddUser(user)}\r\n                >\r\n                  <UserCard user={user} msg={true}>\r\n                    <i className=\"fas fa-circle\" />\r\n                  </UserCard>\r\n                </div>\r\n              ))}\r\n            </>\r\n          )}\r\n\r\n          <button style={{opacity: 0}} ref={pageEnd}>Load more..</button>\r\n        </div>\r\n      </>\r\n    );\r\n}\r\n\r\nexport default LeftSide\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}