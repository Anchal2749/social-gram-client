{"ast":null,"code":"import{GLOBALTYPES}from\"./globalTypes\";import{postDataAPI,getDataAPI}from\"../../utils/fetchData\";export const MESSAGE_TYPES={ADD_USER:\"ADD_USER\",ADD_MESSAGE:\"ADD_MESSAGE\",GET_CONVERSATIONS:\"GET_CONVERSATIONS\",GET_MESSAGES:\"GET_MESSAGES\"};export const addUser=_ref=>{let{user,message}=_ref;return async dispatch=>{if(message.users.every(item=>item._id!==user._id)){dispatch({type:MESSAGE_TYPES.ADD_USER,payload:{...user,text:'',media:[]}});}};};export const addMessage=_ref2=>{let{msg,auth,socket}=_ref2;return async dispatch=>{dispatch({type:MESSAGE_TYPES.ADD_MESSAGE,payload:msg});socket.emit('addMessage',msg);try{await postDataAPI('message',msg,auth.token);}catch(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err.response.data.msg}});}};};export const getConversations=_ref3=>{let{auth,page=1}=_ref3;return async dispatch=>{try{const res=await getDataAPI(`conversations?limit=${page*9}`,auth.token);let newArr=[];res.data.conversations.forEach(item=>{item.recipients.forEach(cv=>{if(cv._id!==auth.user._id){newArr.push({...cv,text:item.text,media:item.media});}});});dispatch({type:MESSAGE_TYPES.GET_CONVERSATIONS,payload:{newArr,result:res.data.result}});}catch(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err.response.data.msg}});}};};export const getMessages=_ref4=>{let{auth,id,page=1}=_ref4;return async dispatch=>{try{const res=await getDataAPI(`message/${id}?limit=${page*9}`,auth.token);dispatch({type:MESSAGE_TYPES.GET_MESSAGES,payload:res.data});}catch(err){dispatch({type:GLOBALTYPES.ALERT,payload:{error:err.response.data.msg}});}};};","map":{"version":3,"names":["GLOBALTYPES","postDataAPI","getDataAPI","MESSAGE_TYPES","ADD_USER","ADD_MESSAGE","GET_CONVERSATIONS","GET_MESSAGES","addUser","_ref","user","message","dispatch","users","every","item","_id","type","payload","text","media","addMessage","_ref2","msg","auth","socket","emit","token","err","ALERT","error","response","data","getConversations","_ref3","page","res","newArr","conversations","forEach","recipients","cv","push","result","getMessages","_ref4","id"],"sources":["C:/Users/ANCHAL MAURYA/Desktop/mern-social-media/client/src/redux/actions/messageAction.js"],"sourcesContent":["import { GLOBALTYPES } from \"./globalTypes\";\r\nimport { postDataAPI, getDataAPI } from \"../../utils/fetchData\";\r\n\r\n\r\nexport const MESSAGE_TYPES = {\r\n  ADD_USER: \"ADD_USER\",\r\n  ADD_MESSAGE: \"ADD_MESSAGE\",\r\n  GET_CONVERSATIONS: \"GET_CONVERSATIONS\",\r\n  GET_MESSAGES: \"GET_MESSAGES\",\r\n};\r\n\r\nexport const addUser = ({ user, message }) => async (dispatch) => {\r\n    if(message.users.every(item => item._id !== user._id)){\r\n        dispatch({type: MESSAGE_TYPES.ADD_USER, payload: {...user, text: '', media: []} });\r\n    }\r\n};\r\n\r\nexport const addMessage = ({ msg, auth, socket }) => async (dispatch) => {\r\n\r\n  dispatch({type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg});\r\n  socket.emit('addMessage', msg);\r\n\r\n  try {\r\n    await postDataAPI('message', msg, auth.token)\r\n  } catch (err) {\r\n    dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg } });\r\n  }\r\n}\r\n\r\nexport const getConversations = ({auth, page = 1 }) => async (dispatch) => {\r\ntry {\r\n    const res = await getDataAPI(`conversations?limit=${page * 9}`, auth.token);\r\n    let newArr = [];\r\n    res.data.conversations.forEach(item => {\r\n      item.recipients.forEach(cv => {\r\n        if(cv._id !== auth.user._id){\r\n          newArr.push({...cv, text: item.text, media: item.media});\r\n        }\r\n      })\r\n    });\r\n\r\n    dispatch({ type: MESSAGE_TYPES.GET_CONVERSATIONS, payload: {newArr, result: res.data.result} });\r\n  } catch (err) {\r\n    dispatch({ type: GLOBALTYPES.ALERT, payload: {error: err.response.data.msg } });\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\nexport const getMessages = ({ auth, id, page = 1 }) => async (dispatch) => {\r\n  try {\r\n    const res = await getDataAPI(`message/${id}?limit=${page * 9}`, auth.token);\r\n\r\n    dispatch({ type: MESSAGE_TYPES.GET_MESSAGES, payload: res.data });\r\n  } catch (err) {\r\n    dispatch({\r\n      type: GLOBALTYPES.ALERT,\r\n      payload: { error: err.response.data.msg },\r\n    });\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}