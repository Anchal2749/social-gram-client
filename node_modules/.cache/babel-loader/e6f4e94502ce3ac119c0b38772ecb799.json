{"ast":null,"code":"import React,{useEffect,useRef}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{POST_TYPES}from\"./redux/actions/postAction\";import{ADMIN_TYPES}from\"./redux/actions/adminAction\";import{GLOBALTYPES}from\"./redux/actions/globalTypes\";import{NOTIFY_TYPES}from\"./redux/actions/notifyAction\";import{MESSAGE_TYPES}from\"./redux/actions/messageAction\";import audioTone from'./audio/pristine-609.mp3';import{jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const spawnNotification=(body,icon,url,title)=>{let options={body,icon};let n=new Notification(title,options);n.onclick=e=>{e.preventDefault();window.open(url,'_blank');};};const SocketClient=()=>{const{auth,socket,notify}=useSelector(state=>state);const dispatch=useDispatch();const audioRef=useRef();//!connection\nuseEffect(()=>{if(auth.user.role===\"user\"){socket.emit(\"joinUser\",auth.user._id);}else if(auth.user.role===\"admin\"){socket.emit(\"joinAdmin\",auth.user._id);}},[socket,auth.user.role,auth.user._id]);useEffect(()=>{socket.on(\"getActiveUsersToClient\",totalActiveUsers=>{dispatch({type:ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,payload:totalActiveUsers});});return()=>socket.off(\"getActiveUsersToClient\");},[socket,dispatch]);//!like Post\nuseEffect(()=>{socket.on(\"likeToClient\",newPost=>{dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return()=>socket.off(\"likeToClient\");},[socket,dispatch]);//!Unlike Post\nuseEffect(()=>{socket.on(\"unLikeToClient\",newPost=>{dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return()=>socket.off(\"unLikeToClient\");},[socket,dispatch]);//!Comments\nuseEffect(()=>{socket.on(\"createCommentToClient\",newPost=>{dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return()=>socket.off(\"createCommentToClient\");},[socket,dispatch]);useEffect(()=>{socket.on(\"deleteCommentToClient\",newPost=>{dispatch({type:POST_TYPES.UPDATE_POST,payload:newPost});});return()=>socket.off(\"deleteCommentToClient\");},[socket,dispatch]);//!Follow\nuseEffect(()=>{socket.on(\"followToClient\",newUser=>{dispatch({type:GLOBALTYPES.AUTH,payload:{...auth,user:newUser}});});return()=>socket.off(\"followToClient\");},[socket,dispatch,auth]);useEffect(()=>{socket.on(\"unFollowToClient\",newUser=>{dispatch({type:GLOBALTYPES.AUTH,payload:{...auth,user:newUser}});});return()=>socket.off(\"unFollowToClient\");},[socket,dispatch,auth]);//!Notifications\nuseEffect(()=>{socket.on(\"createNotifyToClient\",msg=>{dispatch({type:NOTIFY_TYPES.CREATE_NOTIFY,payload:msg});if(notify.sound){audioRef.current.play();}spawnNotification(msg.user.username+\" \"+msg.text,msg.user.avatar,msg.url,\"CAMPUS CONNECT\");});return()=>socket.off(\"createNotifyToClient\");},[socket,dispatch,notify.sound]);useEffect(()=>{socket.on(\"removeNotifyToClient\",msg=>{dispatch({type:NOTIFY_TYPES.REMOVE_NOTIFY,payload:msg});});return()=>socket.off(\"removeNotifyToClient\");},[socket,dispatch]);//!Messages\nuseEffect(()=>{socket.on(\"addMessageToClient\",msg=>{dispatch({type:MESSAGE_TYPES.ADD_MESSAGE,payload:msg});});return()=>socket.off(\"addMessageToClient\");},[]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"audio\",{controls:true,ref:audioRef,style:{display:\"none\"},children:/*#__PURE__*/_jsx(\"source\",{src:audioTone,type:\"audio/mp3\"})})});};export default SocketClient;","map":{"version":3,"names":["React","useEffect","useRef","useDispatch","useSelector","POST_TYPES","ADMIN_TYPES","GLOBALTYPES","NOTIFY_TYPES","MESSAGE_TYPES","audioTone","jsx","_jsx","Fragment","_Fragment","spawnNotification","body","icon","url","title","options","n","Notification","onclick","e","preventDefault","window","open","SocketClient","auth","socket","notify","state","dispatch","audioRef","user","role","emit","_id","on","totalActiveUsers","type","GET_TOTAL_ACTIVE_USERS","payload","off","newPost","UPDATE_POST","newUser","AUTH","msg","CREATE_NOTIFY","sound","current","play","username","text","avatar","REMOVE_NOTIFY","ADD_MESSAGE","children","controls","ref","style","display","src"],"sources":["C:/Users/ANCHAL MAURYA/Desktop/mern-social-media/client/src/SocketClient.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { POST_TYPES } from \"./redux/actions/postAction\";\r\nimport { ADMIN_TYPES } from \"./redux/actions/adminAction\";\r\nimport { GLOBALTYPES } from \"./redux/actions/globalTypes\";\r\nimport { NOTIFY_TYPES } from \"./redux/actions/notifyAction\";\r\nimport { MESSAGE_TYPES } from \"./redux/actions/messageAction\";\r\n\r\nimport audioTone from './audio/pristine-609.mp3' \r\n\r\nconst spawnNotification = (body, icon, url, title) => {\r\n  let options = {\r\n    body, icon\r\n  }\r\n  let n = new Notification(title, options);\r\n  n.onclick =  e => {\r\n    e.preventDefault();\r\n    window.open(url, '_blank');\r\n  }\r\n}\r\n\r\nconst SocketClient = () => {\r\n  const { auth, socket, notify } = useSelector((state) => state);\r\n  const dispatch = useDispatch();\r\n\r\n  const audioRef = useRef();\r\n\r\n  //!connection\r\n  useEffect(() => {\r\n    if (auth.user.role === \"user\") {\r\n      socket.emit(\"joinUser\", auth.user._id);\r\n    } else if (auth.user.role === \"admin\") {\r\n      socket.emit(\"joinAdmin\", auth.user._id);\r\n    }\r\n  }, [socket, auth.user.role, auth.user._id]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"getActiveUsersToClient\", (totalActiveUsers) => {\r\n      dispatch({\r\n        type: ADMIN_TYPES.GET_TOTAL_ACTIVE_USERS,\r\n        payload: totalActiveUsers,\r\n      });\r\n    });\r\n    return () => socket.off(\"getActiveUsersToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!like Post\r\n  useEffect(() => {\r\n    socket.on(\"likeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"likeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Unlike Post\r\n  useEffect(() => {\r\n    socket.on(\"unLikeToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"unLikeToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Comments\r\n  useEffect(() => {\r\n    socket.on(\"createCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"createCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"deleteCommentToClient\", (newPost) => {\r\n      dispatch({ type: POST_TYPES.UPDATE_POST, payload: newPost });\r\n    });\r\n    return () => socket.off(\"deleteCommentToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Follow\r\n  useEffect(() => {\r\n    socket.on(\"followToClient\", (newUser) => {\r\n      dispatch({ type: GLOBALTYPES.AUTH, payload: { ...auth, user: newUser } });\r\n    });\r\n    return () => socket.off(\"followToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"unFollowToClient\", (newUser) => {\r\n      dispatch({\r\n        type: GLOBALTYPES.AUTH,\r\n        payload: { ...auth, user: newUser },\r\n      });\r\n    });\r\n    return () => socket.off(\"unFollowToClient\");\r\n  }, [socket, dispatch, auth]);\r\n\r\n  //!Notifications\r\n  useEffect(() => {\r\n    socket.on(\"createNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.CREATE_NOTIFY, payload: msg });\r\n\r\n      if (notify.sound) {\r\n        audioRef.current.play();\r\n      }\r\n      spawnNotification(\r\n        msg.user.username + \" \" + msg.text,\r\n        msg.user.avatar,\r\n        msg.url,\r\n        \"CAMPUS CONNECT\"\r\n      );\r\n    });\r\n    return () => socket.off(\"createNotifyToClient\");\r\n  }, [socket, dispatch, notify.sound]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"removeNotifyToClient\", (msg) => {\r\n      dispatch({ type: NOTIFY_TYPES.REMOVE_NOTIFY, payload: msg });\r\n    });\r\n    return () => socket.off(\"removeNotifyToClient\");\r\n  }, [socket, dispatch]);\r\n\r\n  //!Messages\r\n  useEffect(() => {\r\n    socket.on(\"addMessageToClient\", (msg) => {\r\n      dispatch({ type: MESSAGE_TYPES.ADD_MESSAGE, payload: msg });\r\n\r\n    });\r\n    return () => socket.off(\"addMessageToClient\");\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <audio controls ref={audioRef} style={{ display: \"none\" }}>\r\n        <source src={audioTone} type=\"audio/mp3\" />\r\n      </audio>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default SocketClient;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}